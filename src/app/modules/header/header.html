<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top">
  <div class="container">

    <!-- IZQUIERDA: logo + saludo SIEMPRE visibles -->
    <div class="brand-area d-flex align-items-center me-auto flex-nowrap">
      <a class="navbar-brand d-flex align-items-center me-2" href="#inicio">
        <img src="assets/huellitas/Imagenes/LOGO2.png" alt="Logo" class="brand-logo" />
      </a>

      <!-- Saludo (envuelto en ng-container para evitar error) -->
      <ng-container *ngIf="user as u">
        <div class="user-pill d-flex align-items-center">
          <i class="bi bi-person-circle me-2"></i>
          <span *ngIf="u.rol === 'admin'">Administrador</span>
          <span *ngIf="u.rol !== 'admin'">Bienvenido, {{ u.name | titlecase }}</span>
        </div>
      </ng-container>
    </div>

    <!-- Botón hamburguesa -->
    <button
      id="navbarToggler"
      class="navbar-toggler"
      type="button"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
      (click)="toggleNavbar()"   
    >
      <span class="navbar-toggler-icon"></span>
    </button>



    <!-- Menú -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">

        <li class="nav-item">
          <a class="nav-link" href="#sobre-nosotros">Sobre Nosotros</a>
        </li>

        <!-- Mostrar solo si NO hay usuario logueado -->
        <li class="nav-item position-relative"
            *ngIf="!user"
            (mouseenter)="mostrarSubmenu = true"
            (mouseleave)="mostrarSubmenu = false">
          <a class="nav-link" href="#" (click)="abrirAuth()">Iniciar sesión</a>
        </li>

        <!-- Submenú visible solo para admin logueado -->
        <li class="nav-item position-relative"
            *ngIf="esAdmin() && user"
            (mouseenter)="mostrarSubmenu = true"
            (mouseleave)="mostrarSubmenu = false">
          <a class="nav-link" href="#" (click)="irAlAdmin($event)">Panel de Administración</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="#especialidades">Nuestras Especialidades</a>
        </li>

        <!-- Verifica usuario antes de ir al calendario -->
        <li class="nav-item">
          <a class="nav-link" href="#" (click)="abrirCalendario($event)">Separar una cita</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="#contactanos">Contáctanos</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="#inicio">Inicio</a>
        </li>

                <!-- Botón de salida visible para todos los usuarios logueados -->
        <li class="nav-item" *ngIf="user">
          <a class="nav-link text-danger fw-bold" href="#" (click)="logout()">Salir</a>
        </li>

      </ul>
    </div>
  </div>
</nav>

<!-- Componentes dinámicos -->
<app-authentication *ngIf="mostrarAuth"></app-authentication>

<!-- MODAL DE REGISTRO -->
<div
  class="modal fade"
  id="registroModal"
  tabindex="-1"
  aria-labelledby="registroModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-white rounded-4">

      <div class="modal-header border-0 justify-content-center">
        <div class="bg-warning text-dark rounded-circle p-3">
          <i class="bi bi-person-plus-fill fs-3"></i>
        </div>
      </div>

      <div class="modal-body text-center">
        <h4 class="fw-bold mb-2">Crear cuenta</h4>
        <p class="text-secondary mb-4">Regístrate para acceder</p>

        <form #registroForm="ngForm" novalidate>

          <div class="mb-3 text-start">
            <label for="regEmail" class="form-label text-secondary">Correo Electrónico</label>
            <input
              type="email"
              id="regEmail"
              name="email"
              class="form-control"
              placeholder="tu@email.com"
              required
              ngModel
            />
          </div>

          <div class="mb-3 text-start">
            <label for="regPassword" class="form-label text-secondary">Contraseña</label>
            <input
              type="password"
              id="regPassword"
              name="password"
              class="form-control"
              placeholder="********"
              required
              ngModel
            />
          </div>

          <div class="mb-3 text-start">
            <label for="confirmPassword" class="form-label text-secondary">Confirmar Contraseña</label>
            <input
              type="password"
              id="confirmPassword"
              name="confirmPassword"
              class="form-control"
              placeholder="********"
              required
              ngModel
            />
          </div>

          <div class="form-check mb-3 text-start">
            <input
              class="form-check-input"
              type="checkbox"
              id="aceptaTerminos"
              required
              ngModel
              name="aceptaTerminos"
            />
            <label class="form-check-label text-secondary" for="aceptaTerminos">
              Acepto los
              <a href="#" class="text-warning text-decoration-none">términos y condiciones</a>
            </label>
          </div>

          <button
            type="button"
            class="btn btn-warning w-100 text-dark fw-bold"
            [disabled]="registroForm.invalid"
            (click)="onRegister(registroForm)"
          >
            Crear Cuenta
          </button>

          <button
            type="button"
            class="btn btn-outline-light w-100 mt-2"
            data-bs-dismiss="modal"
          >
            Cancelar
          </button>

          <div class="mt-3">
            <span class="text-secondary">¿Ya tienes cuenta?</span>
            <a
              href="#"
              class="text-warning text-decoration-none"
              data-bs-dismiss="modal"
              data-bs-toggle="modal"
              data-bs-target="#loginModal"
            >
              Inicia sesión
            </a>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>
